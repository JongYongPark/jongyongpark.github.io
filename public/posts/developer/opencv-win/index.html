<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>OpenCV compile on Windows | RyanLabs</title>
<meta name=keywords content="OpenCV,Windows"><meta name=description content='Claude
이 오류는 ARM64 플랫폼을 위한 CMake 구성 과정에서 발생한 문제입니다. 주요 오류는 프로젝트 설정이 제대로 되지 않았고, ARM64 플랫폼 구성이 올바르지 않다는 것입니다.
PowerShell 스크립트를 다음과 같이 수정하여 해결할 수 있습니다:
# OpenCV Windows Build Script for x64 and ARM64
# Prerequisites: Visual Studio 2022, CMake, Git

# Configuration
$OPENCV_VERSION = "4.9.0"
$SOURCE_DIR = "C:\workspace\jonpark-work\opencv_source"
$BUILD_BASE_DIR = "C:\workspace\jonpark-work\opencv_build"
$INSTALL_BASE_DIR = "C:\workspace\jonpark-work\opencv_install"

# Common CMake parameters
$CMAKE_COMMON_PARAMS = @(
    "-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10",  # 최소 CMake 버전 지정
    "-DBUILD_SHARED_LIBS=ON",
    "-DBUILD_TESTS=OFF",
    "-DBUILD_PERF_TESTS=OFF",
    "-DBUILD_EXAMPLES=OFF",
    "-DWITH_CUDA=OFF",
    "-DBUILD_opencv_world=ON",
    "-DBUILD_opencv_python2=OFF",
    "-DBUILD_opencv_python3=OFF",
    "-DWITH_IPP=ON",
    "-DENABLE_CXX11=ON",
    "-DOPENCV_ENABLE_NONFREE=ON",
    "-DBUILD_WITH_STATIC_CRT=OFF"
)

# Download OpenCV source
if (-not (Test-Path $SOURCE_DIR)) {
    git clone https://github.com/opencv/opencv.git $SOURCE_DIR
    Push-Location $SOURCE_DIR
    git checkout $OPENCV_VERSION
    Pop-Location
}

# Function to build OpenCV for specific architecture
function Build-OpenCV {
    param (
        [string]$arch,
        [string]$generator,
        [string]$platform
    )

    $BUILD_DIR = "$BUILD_BASE_DIR\$arch"
    $INSTALL_DIR = "$INSTALL_BASE_DIR\$arch"

    # Remove existing build directory to ensure clean build
    if (Test-Path $BUILD_DIR) {
        Remove-Item -Path $BUILD_DIR -Recurse -Force
    }

    # Create build directory
    New-Item -ItemType Directory -Force -Path $BUILD_DIR
    Push-Location $BUILD_DIR

    # Configure CMake with explicit project name and build type
    cmake -G $generator -A $platform `
        -DCMAKE_INSTALL_PREFIX="$INSTALL_DIR" `
        -DCMAKE_BUILD_TYPE=Release `
        -DOpenCV_ARCH=$platform `
        -DOpenCV_RUNTIME=vc17 `
        $CMAKE_COMMON_PARAMS `
        -S $SOURCE_DIR -B $BUILD_DIR

    if ($LASTEXITCODE -ne 0) {
        Write-Error "CMake configuration failed for $arch"
        Pop-Location
        exit 1
    }

    # Build and install
    cmake --build $BUILD_DIR --config Release --target INSTALL --parallel 8

    if ($LASTEXITCODE -ne 0) {
        Write-Error "Build failed for $arch"
        Pop-Location
        exit 1
    }

    Pop-Location
}

# 빌드 전 Visual Studio 환경 설정
$VS_PATH = "C:\Program Files\Microsoft Visual Studio\2022\Community"
$VS_TOOLS = "$VS_PATH\VC\Auxiliary\Build"

if (Test-Path "$VS_TOOLS\vcvarsall.bat") {
    Write-Host "Setting up Visual Studio environment..."
    # x64 환경 설정
    cmd.exe /c "call `"$VS_TOOLS\vcvarsall.bat`" x64 && set > %temp%\vcvars.txt"
    Get-Content "$env:temp\vcvars.txt" | foreach-object {
        if ($_ -match "^(.*?)=(.*)$") {
            Set-Content "env:\$($matches[1])" $matches[2]
        }
    }
} else {
    Write-Error "Visual Studio environment setup failed"
    exit 1
}

# Build for x64
Write-Host "Building for x64..."
Build-OpenCV -arch "x64" -generator "Visual Studio 17 2022" -platform "x64"

# ARM64 빌드 전 환경 재설정
if (Test-Path "$VS_TOOLS\vcvarsall.bat") {
    Write-Host "Setting up Visual Studio environment for ARM64..."
    cmd.exe /c "call `"$VS_TOOLS\vcvarsall.bat`" x64_arm64 && set > %temp%\vcvars.txt"
    Get-Content "$env:temp\vcvars.txt" | foreach-object {
        if ($_ -match "^(.*?)=(.*)$") {
            Set-Content "env:\$($matches[1])" $matches[2]
        }
    }
}

# Build for ARM64
Write-Host "Building for ARM64..."
Build-OpenCV -arch "arm64" -generator "Visual Studio 17 2022" -platform "ARM64"
주요 변경사항과 해결방법:'><meta name=author content><link rel=canonical href=https://jongyongpark.github.io/posts/developer/opencv-win/><link crossorigin=anonymous href=/assets/css/stylesheet.9de45e225101e4f99701d2b68fc6b8a1ef6027928be6391fa15bf7f56326c909.css integrity="sha256-neReIlEB5PmXAdK2j8a4oe9gJ5KL5jkfoVv39WMmyQk=" rel="preload stylesheet" as=style><link rel=icon href=https://jongyongpark.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jongyongpark.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jongyongpark.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://jongyongpark.github.io/apple-touch-icon.png><link rel=mask-icon href=https://jongyongpark.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://jongyongpark.github.io/posts/developer/opencv-win/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://jongyongpark.github.io/posts/developer/opencv-win/"><meta property="og:site_name" content="RyanLabs"><meta property="og:title" content="OpenCV compile on Windows"><meta property="og:description" content='Claude 이 오류는 ARM64 플랫폼을 위한 CMake 구성 과정에서 발생한 문제입니다. 주요 오류는 프로젝트 설정이 제대로 되지 않았고, ARM64 플랫폼 구성이 올바르지 않다는 것입니다.
PowerShell 스크립트를 다음과 같이 수정하여 해결할 수 있습니다:
# OpenCV Windows Build Script for x64 and ARM64 # Prerequisites: Visual Studio 2022, CMake, Git # Configuration $OPENCV_VERSION = "4.9.0" $SOURCE_DIR = "C:\workspace\jonpark-work\opencv_source" $BUILD_BASE_DIR = "C:\workspace\jonpark-work\opencv_build" $INSTALL_BASE_DIR = "C:\workspace\jonpark-work\opencv_install" # Common CMake parameters $CMAKE_COMMON_PARAMS = @( "-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10", # 최소 CMake 버전 지정 "-DBUILD_SHARED_LIBS=ON", "-DBUILD_TESTS=OFF", "-DBUILD_PERF_TESTS=OFF", "-DBUILD_EXAMPLES=OFF", "-DWITH_CUDA=OFF", "-DBUILD_opencv_world=ON", "-DBUILD_opencv_python2=OFF", "-DBUILD_opencv_python3=OFF", "-DWITH_IPP=ON", "-DENABLE_CXX11=ON", "-DOPENCV_ENABLE_NONFREE=ON", "-DBUILD_WITH_STATIC_CRT=OFF" ) # Download OpenCV source if (-not (Test-Path $SOURCE_DIR)) { git clone https://github.com/opencv/opencv.git $SOURCE_DIR Push-Location $SOURCE_DIR git checkout $OPENCV_VERSION Pop-Location } # Function to build OpenCV for specific architecture function Build-OpenCV { param ( [string]$arch, [string]$generator, [string]$platform ) $BUILD_DIR = "$BUILD_BASE_DIR\$arch" $INSTALL_DIR = "$INSTALL_BASE_DIR\$arch" # Remove existing build directory to ensure clean build if (Test-Path $BUILD_DIR) { Remove-Item -Path $BUILD_DIR -Recurse -Force } # Create build directory New-Item -ItemType Directory -Force -Path $BUILD_DIR Push-Location $BUILD_DIR # Configure CMake with explicit project name and build type cmake -G $generator -A $platform ` -DCMAKE_INSTALL_PREFIX="$INSTALL_DIR" ` -DCMAKE_BUILD_TYPE=Release ` -DOpenCV_ARCH=$platform ` -DOpenCV_RUNTIME=vc17 ` $CMAKE_COMMON_PARAMS ` -S $SOURCE_DIR -B $BUILD_DIR if ($LASTEXITCODE -ne 0) { Write-Error "CMake configuration failed for $arch" Pop-Location exit 1 } # Build and install cmake --build $BUILD_DIR --config Release --target INSTALL --parallel 8 if ($LASTEXITCODE -ne 0) { Write-Error "Build failed for $arch" Pop-Location exit 1 } Pop-Location } # 빌드 전 Visual Studio 환경 설정 $VS_PATH = "C:\Program Files\Microsoft Visual Studio\2022\Community" $VS_TOOLS = "$VS_PATH\VC\Auxiliary\Build" if (Test-Path "$VS_TOOLS\vcvarsall.bat") { Write-Host "Setting up Visual Studio environment..." # x64 환경 설정 cmd.exe /c "call `"$VS_TOOLS\vcvarsall.bat`" x64 && set > %temp%\vcvars.txt" Get-Content "$env:temp\vcvars.txt" | foreach-object { if ($_ -match "^(.*?)=(.*)$") { Set-Content "env:\$($matches[1])" $matches[2] } } } else { Write-Error "Visual Studio environment setup failed" exit 1 } # Build for x64 Write-Host "Building for x64..." Build-OpenCV -arch "x64" -generator "Visual Studio 17 2022" -platform "x64" # ARM64 빌드 전 환경 재설정 if (Test-Path "$VS_TOOLS\vcvarsall.bat") { Write-Host "Setting up Visual Studio environment for ARM64..." cmd.exe /c "call `"$VS_TOOLS\vcvarsall.bat`" x64_arm64 && set > %temp%\vcvars.txt" Get-Content "$env:temp\vcvars.txt" | foreach-object { if ($_ -match "^(.*?)=(.*)$") { Set-Content "env:\$($matches[1])" $matches[2] } } } # Build for ARM64 Write-Host "Building for ARM64..." Build-OpenCV -arch "arm64" -generator "Visual Studio 17 2022" -platform "ARM64" 주요 변경사항과 해결방법:'><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-20T00:00:00+00:00"><meta property="article:modified_time" content="2025-02-20T00:00:00+00:00"><meta property="article:tag" content="OpenCV"><meta property="article:tag" content="Windows"><meta name=twitter:card content="summary"><meta name=twitter:title content="OpenCV compile on Windows"><meta name=twitter:description content='Claude
이 오류는 ARM64 플랫폼을 위한 CMake 구성 과정에서 발생한 문제입니다. 주요 오류는 프로젝트 설정이 제대로 되지 않았고, ARM64 플랫폼 구성이 올바르지 않다는 것입니다.
PowerShell 스크립트를 다음과 같이 수정하여 해결할 수 있습니다:
# OpenCV Windows Build Script for x64 and ARM64
# Prerequisites: Visual Studio 2022, CMake, Git

# Configuration
$OPENCV_VERSION = "4.9.0"
$SOURCE_DIR = "C:\workspace\jonpark-work\opencv_source"
$BUILD_BASE_DIR = "C:\workspace\jonpark-work\opencv_build"
$INSTALL_BASE_DIR = "C:\workspace\jonpark-work\opencv_install"

# Common CMake parameters
$CMAKE_COMMON_PARAMS = @(
    "-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10",  # 최소 CMake 버전 지정
    "-DBUILD_SHARED_LIBS=ON",
    "-DBUILD_TESTS=OFF",
    "-DBUILD_PERF_TESTS=OFF",
    "-DBUILD_EXAMPLES=OFF",
    "-DWITH_CUDA=OFF",
    "-DBUILD_opencv_world=ON",
    "-DBUILD_opencv_python2=OFF",
    "-DBUILD_opencv_python3=OFF",
    "-DWITH_IPP=ON",
    "-DENABLE_CXX11=ON",
    "-DOPENCV_ENABLE_NONFREE=ON",
    "-DBUILD_WITH_STATIC_CRT=OFF"
)

# Download OpenCV source
if (-not (Test-Path $SOURCE_DIR)) {
    git clone https://github.com/opencv/opencv.git $SOURCE_DIR
    Push-Location $SOURCE_DIR
    git checkout $OPENCV_VERSION
    Pop-Location
}

# Function to build OpenCV for specific architecture
function Build-OpenCV {
    param (
        [string]$arch,
        [string]$generator,
        [string]$platform
    )

    $BUILD_DIR = "$BUILD_BASE_DIR\$arch"
    $INSTALL_DIR = "$INSTALL_BASE_DIR\$arch"

    # Remove existing build directory to ensure clean build
    if (Test-Path $BUILD_DIR) {
        Remove-Item -Path $BUILD_DIR -Recurse -Force
    }

    # Create build directory
    New-Item -ItemType Directory -Force -Path $BUILD_DIR
    Push-Location $BUILD_DIR

    # Configure CMake with explicit project name and build type
    cmake -G $generator -A $platform `
        -DCMAKE_INSTALL_PREFIX="$INSTALL_DIR" `
        -DCMAKE_BUILD_TYPE=Release `
        -DOpenCV_ARCH=$platform `
        -DOpenCV_RUNTIME=vc17 `
        $CMAKE_COMMON_PARAMS `
        -S $SOURCE_DIR -B $BUILD_DIR

    if ($LASTEXITCODE -ne 0) {
        Write-Error "CMake configuration failed for $arch"
        Pop-Location
        exit 1
    }

    # Build and install
    cmake --build $BUILD_DIR --config Release --target INSTALL --parallel 8

    if ($LASTEXITCODE -ne 0) {
        Write-Error "Build failed for $arch"
        Pop-Location
        exit 1
    }

    Pop-Location
}

# 빌드 전 Visual Studio 환경 설정
$VS_PATH = "C:\Program Files\Microsoft Visual Studio\2022\Community"
$VS_TOOLS = "$VS_PATH\VC\Auxiliary\Build"

if (Test-Path "$VS_TOOLS\vcvarsall.bat") {
    Write-Host "Setting up Visual Studio environment..."
    # x64 환경 설정
    cmd.exe /c "call `"$VS_TOOLS\vcvarsall.bat`" x64 && set > %temp%\vcvars.txt"
    Get-Content "$env:temp\vcvars.txt" | foreach-object {
        if ($_ -match "^(.*?)=(.*)$") {
            Set-Content "env:\$($matches[1])" $matches[2]
        }
    }
} else {
    Write-Error "Visual Studio environment setup failed"
    exit 1
}

# Build for x64
Write-Host "Building for x64..."
Build-OpenCV -arch "x64" -generator "Visual Studio 17 2022" -platform "x64"

# ARM64 빌드 전 환경 재설정
if (Test-Path "$VS_TOOLS\vcvarsall.bat") {
    Write-Host "Setting up Visual Studio environment for ARM64..."
    cmd.exe /c "call `"$VS_TOOLS\vcvarsall.bat`" x64_arm64 && set > %temp%\vcvars.txt"
    Get-Content "$env:temp\vcvars.txt" | foreach-object {
        if ($_ -match "^(.*?)=(.*)$") {
            Set-Content "env:\$($matches[1])" $matches[2]
        }
    }
}

# Build for ARM64
Write-Host "Building for ARM64..."
Build-OpenCV -arch "arm64" -generator "Visual Studio 17 2022" -platform "ARM64"
주요 변경사항과 해결방법:'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://jongyongpark.github.io/posts/"},{"@type":"ListItem","position":2,"name":"OpenCV compile on Windows","item":"https://jongyongpark.github.io/posts/developer/opencv-win/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"OpenCV compile on Windows","name":"OpenCV compile on Windows","description":"Claude 이 오류는 ARM64 플랫폼을 위한 CMake 구성 과정에서 발생한 문제입니다. 주요 오류는 프로젝트 설정이 제대로 되지 않았고, ARM64 플랫폼 구성이 올바르지 않다는 것입니다.\nPowerShell 스크립트를 다음과 같이 수정하여 해결할 수 있습니다:\n# OpenCV Windows Build Script for x64 and ARM64 # Prerequisites: Visual Studio 2022, CMake, Git # Configuration $OPENCV_VERSION = \u0026#34;4.9.0\u0026#34; $SOURCE_DIR = \u0026#34;C:\\workspace\\jonpark-work\\opencv_source\u0026#34; $BUILD_BASE_DIR = \u0026#34;C:\\workspace\\jonpark-work\\opencv_build\u0026#34; $INSTALL_BASE_DIR = \u0026#34;C:\\workspace\\jonpark-work\\opencv_install\u0026#34; # Common CMake parameters $CMAKE_COMMON_PARAMS = @( \u0026#34;-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10\u0026#34;, # 최소 CMake 버전 지정 \u0026#34;-DBUILD_SHARED_LIBS=ON\u0026#34;, \u0026#34;-DBUILD_TESTS=OFF\u0026#34;, \u0026#34;-DBUILD_PERF_TESTS=OFF\u0026#34;, \u0026#34;-DBUILD_EXAMPLES=OFF\u0026#34;, \u0026#34;-DWITH_CUDA=OFF\u0026#34;, \u0026#34;-DBUILD_opencv_world=ON\u0026#34;, \u0026#34;-DBUILD_opencv_python2=OFF\u0026#34;, \u0026#34;-DBUILD_opencv_python3=OFF\u0026#34;, \u0026#34;-DWITH_IPP=ON\u0026#34;, \u0026#34;-DENABLE_CXX11=ON\u0026#34;, \u0026#34;-DOPENCV_ENABLE_NONFREE=ON\u0026#34;, \u0026#34;-DBUILD_WITH_STATIC_CRT=OFF\u0026#34; ) # Download OpenCV source if (-not (Test-Path $SOURCE_DIR)) { git clone https://github.com/opencv/opencv.git $SOURCE_DIR Push-Location $SOURCE_DIR git checkout $OPENCV_VERSION Pop-Location } # Function to build OpenCV for specific architecture function Build-OpenCV { param ( [string]$arch, [string]$generator, [string]$platform ) $BUILD_DIR = \u0026#34;$BUILD_BASE_DIR\\$arch\u0026#34; $INSTALL_DIR = \u0026#34;$INSTALL_BASE_DIR\\$arch\u0026#34; # Remove existing build directory to ensure clean build if (Test-Path $BUILD_DIR) { Remove-Item -Path $BUILD_DIR -Recurse -Force } # Create build directory New-Item -ItemType Directory -Force -Path $BUILD_DIR Push-Location $BUILD_DIR # Configure CMake with explicit project name and build type cmake -G $generator -A $platform ` -DCMAKE_INSTALL_PREFIX=\u0026#34;$INSTALL_DIR\u0026#34; ` -DCMAKE_BUILD_TYPE=Release ` -DOpenCV_ARCH=$platform ` -DOpenCV_RUNTIME=vc17 ` $CMAKE_COMMON_PARAMS ` -S $SOURCE_DIR -B $BUILD_DIR if ($LASTEXITCODE -ne 0) { Write-Error \u0026#34;CMake configuration failed for $arch\u0026#34; Pop-Location exit 1 } # Build and install cmake --build $BUILD_DIR --config Release --target INSTALL --parallel 8 if ($LASTEXITCODE -ne 0) { Write-Error \u0026#34;Build failed for $arch\u0026#34; Pop-Location exit 1 } Pop-Location } # 빌드 전 Visual Studio 환경 설정 $VS_PATH = \u0026#34;C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\u0026#34; $VS_TOOLS = \u0026#34;$VS_PATH\\VC\\Auxiliary\\Build\u0026#34; if (Test-Path \u0026#34;$VS_TOOLS\\vcvarsall.bat\u0026#34;) { Write-Host \u0026#34;Setting up Visual Studio environment...\u0026#34; # x64 환경 설정 cmd.exe /c \u0026#34;call `\u0026#34;$VS_TOOLS\\vcvarsall.bat`\u0026#34; x64 \u0026amp;\u0026amp; set \u0026gt; %temp%\\vcvars.txt\u0026#34; Get-Content \u0026#34;$env:temp\\vcvars.txt\u0026#34; | foreach-object { if ($_ -match \u0026#34;^(.*?)=(.*)$\u0026#34;) { Set-Content \u0026#34;env:\\$($matches[1])\u0026#34; $matches[2] } } } else { Write-Error \u0026#34;Visual Studio environment setup failed\u0026#34; exit 1 } # Build for x64 Write-Host \u0026#34;Building for x64...\u0026#34; Build-OpenCV -arch \u0026#34;x64\u0026#34; -generator \u0026#34;Visual Studio 17 2022\u0026#34; -platform \u0026#34;x64\u0026#34; # ARM64 빌드 전 환경 재설정 if (Test-Path \u0026#34;$VS_TOOLS\\vcvarsall.bat\u0026#34;) { Write-Host \u0026#34;Setting up Visual Studio environment for ARM64...\u0026#34; cmd.exe /c \u0026#34;call `\u0026#34;$VS_TOOLS\\vcvarsall.bat`\u0026#34; x64_arm64 \u0026amp;\u0026amp; set \u0026gt; %temp%\\vcvars.txt\u0026#34; Get-Content \u0026#34;$env:temp\\vcvars.txt\u0026#34; | foreach-object { if ($_ -match \u0026#34;^(.*?)=(.*)$\u0026#34;) { Set-Content \u0026#34;env:\\$($matches[1])\u0026#34; $matches[2] } } } # Build for ARM64 Write-Host \u0026#34;Building for ARM64...\u0026#34; Build-OpenCV -arch \u0026#34;arm64\u0026#34; -generator \u0026#34;Visual Studio 17 2022\u0026#34; -platform \u0026#34;ARM64\u0026#34; 주요 변경사항과 해결방법:\n","keywords":["OpenCV","Windows"],"articleBody":"Claude 이 오류는 ARM64 플랫폼을 위한 CMake 구성 과정에서 발생한 문제입니다. 주요 오류는 프로젝트 설정이 제대로 되지 않았고, ARM64 플랫폼 구성이 올바르지 않다는 것입니다.\nPowerShell 스크립트를 다음과 같이 수정하여 해결할 수 있습니다:\n# OpenCV Windows Build Script for x64 and ARM64 # Prerequisites: Visual Studio 2022, CMake, Git # Configuration $OPENCV_VERSION = \"4.9.0\" $SOURCE_DIR = \"C:\\workspace\\jonpark-work\\opencv_source\" $BUILD_BASE_DIR = \"C:\\workspace\\jonpark-work\\opencv_build\" $INSTALL_BASE_DIR = \"C:\\workspace\\jonpark-work\\opencv_install\" # Common CMake parameters $CMAKE_COMMON_PARAMS = @( \"-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10\", # 최소 CMake 버전 지정 \"-DBUILD_SHARED_LIBS=ON\", \"-DBUILD_TESTS=OFF\", \"-DBUILD_PERF_TESTS=OFF\", \"-DBUILD_EXAMPLES=OFF\", \"-DWITH_CUDA=OFF\", \"-DBUILD_opencv_world=ON\", \"-DBUILD_opencv_python2=OFF\", \"-DBUILD_opencv_python3=OFF\", \"-DWITH_IPP=ON\", \"-DENABLE_CXX11=ON\", \"-DOPENCV_ENABLE_NONFREE=ON\", \"-DBUILD_WITH_STATIC_CRT=OFF\" ) # Download OpenCV source if (-not (Test-Path $SOURCE_DIR)) { git clone https://github.com/opencv/opencv.git $SOURCE_DIR Push-Location $SOURCE_DIR git checkout $OPENCV_VERSION Pop-Location } # Function to build OpenCV for specific architecture function Build-OpenCV { param ( [string]$arch, [string]$generator, [string]$platform ) $BUILD_DIR = \"$BUILD_BASE_DIR\\$arch\" $INSTALL_DIR = \"$INSTALL_BASE_DIR\\$arch\" # Remove existing build directory to ensure clean build if (Test-Path $BUILD_DIR) { Remove-Item -Path $BUILD_DIR -Recurse -Force } # Create build directory New-Item -ItemType Directory -Force -Path $BUILD_DIR Push-Location $BUILD_DIR # Configure CMake with explicit project name and build type cmake -G $generator -A $platform ` -DCMAKE_INSTALL_PREFIX=\"$INSTALL_DIR\" ` -DCMAKE_BUILD_TYPE=Release ` -DOpenCV_ARCH=$platform ` -DOpenCV_RUNTIME=vc17 ` $CMAKE_COMMON_PARAMS ` -S $SOURCE_DIR -B $BUILD_DIR if ($LASTEXITCODE -ne 0) { Write-Error \"CMake configuration failed for $arch\" Pop-Location exit 1 } # Build and install cmake --build $BUILD_DIR --config Release --target INSTALL --parallel 8 if ($LASTEXITCODE -ne 0) { Write-Error \"Build failed for $arch\" Pop-Location exit 1 } Pop-Location } # 빌드 전 Visual Studio 환경 설정 $VS_PATH = \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\" $VS_TOOLS = \"$VS_PATH\\VC\\Auxiliary\\Build\" if (Test-Path \"$VS_TOOLS\\vcvarsall.bat\") { Write-Host \"Setting up Visual Studio environment...\" # x64 환경 설정 cmd.exe /c \"call `\"$VS_TOOLS\\vcvarsall.bat`\" x64 \u0026\u0026 set \u003e %temp%\\vcvars.txt\" Get-Content \"$env:temp\\vcvars.txt\" | foreach-object { if ($_ -match \"^(.*?)=(.*)$\") { Set-Content \"env:\\$($matches[1])\" $matches[2] } } } else { Write-Error \"Visual Studio environment setup failed\" exit 1 } # Build for x64 Write-Host \"Building for x64...\" Build-OpenCV -arch \"x64\" -generator \"Visual Studio 17 2022\" -platform \"x64\" # ARM64 빌드 전 환경 재설정 if (Test-Path \"$VS_TOOLS\\vcvarsall.bat\") { Write-Host \"Setting up Visual Studio environment for ARM64...\" cmd.exe /c \"call `\"$VS_TOOLS\\vcvarsall.bat`\" x64_arm64 \u0026\u0026 set \u003e %temp%\\vcvars.txt\" Get-Content \"$env:temp\\vcvars.txt\" | foreach-object { if ($_ -match \"^(.*?)=(.*)$\") { Set-Content \"env:\\$($matches[1])\" $matches[2] } } } # Build for ARM64 Write-Host \"Building for ARM64...\" Build-OpenCV -arch \"arm64\" -generator \"Visual Studio 17 2022\" -platform \"ARM64\" 주요 변경사항과 해결방법:\nVisual Studio 환경 설정 추가\nvcvarsall.bat을 사용하여 적절한 빌드 환경 설정 x64와 ARM64 각각에 대해 별도의 환경 설정 CMake 구성 개선\n명시적으로 프로젝트 소스와 빌드 디렉토리 지정 (-S, -B 옵션) CMAKE_BUILD_TYPE을 명시적으로 지정 OpenCV 관련 추가 파라미터 설정 빌드 디렉토리 정리\n빌드 전 기존 디렉토리 제거하여 클린 빌드 보장 오류 처리 개선\nCMake 구성과 빌드 단계에서의 오류 확인 실패 시 적절한 오류 메시지 출력 스크립트 실행 방법:\nPowerShell을 관리자 권한으로 실행 스크립트가 있는 디렉토리로 이동 .\\opencv-build.ps1 실행 이 수정된 스크립트는 이전 오류들을 해결하고, 더 안정적인 빌드 프로세스를 제공합니다.\n인자로 옶션 받도록 수정 # OpenCV Windows Build Script for x64 and ARM64 param ( [Parameter()] [ValidateSet('build', 'clean')] [string]$Action = 'build', [Parameter()] [ValidateSet('x64', 'arm64', 'all')] [string]$Platform = 'all' ) # Configuration $OPENCV_VERSION = \"4.9.0\" $SOURCE_DIR = \"C:\\workspace\\jonpark-work\\opencv_source\" $BUILD_BASE_DIR = \"C:\\workspace\\jonpark-work\\opencv_build\" $INSTALL_BASE_DIR = \"C:\\workspace\\jonpark-work\\opencv_install\" # Common CMake parameters $CMAKE_COMMON_PARAMS = @( \"-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10\", \"-DBUILD_SHARED_LIBS=ON\", \"-DBUILD_TESTS=OFF\", \"-DBUILD_PERF_TESTS=OFF\", \"-DBUILD_EXAMPLES=OFF\", \"-DWITH_CUDA=OFF\", \"-DBUILD_opencv_world=ON\", \"-DBUILD_opencv_python2=OFF\", \"-DBUILD_opencv_python3=OFF\", \"-DWITH_IPP=ON\", \"-DENABLE_CXX11=ON\", \"-DOPENCV_ENABLE_NONFREE=ON\", \"-DBUILD_WITH_STATIC_CRT=OFF\" ) # Clean function function Clean-Build { param ( [string]$arch ) $BUILD_DIR = \"$BUILD_BASE_DIR\\$arch\" $INSTALL_DIR = \"$INSTALL_BASE_DIR\\$arch\" Write-Host \"Cleaning $arch build directories...\" if (Test-Path $BUILD_DIR) { Remove-Item -Path $BUILD_DIR -Recurse -Force Write-Host \"Removed build directory: $BUILD_DIR\" } if (Test-Path $INSTALL_DIR) { Remove-Item -Path $INSTALL_DIR -Recurse -Force Write-Host \"Removed install directory: $INSTALL_DIR\" } } # Download OpenCV source function Get-OpenCVSource { if (-not (Test-Path $SOURCE_DIR)) { Write-Host \"Cloning OpenCV repository...\" git clone https://github.com/opencv/opencv.git $SOURCE_DIR Push-Location $SOURCE_DIR git checkout $OPENCV_VERSION Pop-Location } } # Function to build OpenCV for specific architecture function Build-OpenCV { param ( [string]$arch, [string]$generator, [string]$platform ) $BUILD_DIR = \"$BUILD_BASE_DIR\\$arch\" $INSTALL_DIR = \"$INSTALL_BASE_DIR\\$arch\" Write-Host \"Building OpenCV for $arch...\" # Create build directory New-Item -ItemType Directory -Force -Path $BUILD_DIR Push-Location $BUILD_DIR # Configure CMake with explicit project name and build type Write-Host \"Configuring CMake for $arch...\" cmake -G $generator -A $platform ` -DCMAKE_INSTALL_PREFIX=\"$INSTALL_DIR\" ` -DCMAKE_BUILD_TYPE=Release ` -DOpenCV_ARCH=$platform ` -DOpenCV_RUNTIME=vc17 ` $CMAKE_COMMON_PARAMS ` -S $SOURCE_DIR -B $BUILD_DIR if ($LASTEXITCODE -ne 0) { Write-Error \"CMake configuration failed for $arch\" Pop-Location exit 1 } # Build and install Write-Host \"Building and installing for $arch...\" cmake --build $BUILD_DIR --config Release --target INSTALL --parallel 8 if ($LASTEXITCODE -ne 0) { Write-Error \"Build failed for $arch\" Pop-Location exit 1 } Pop-Location Write-Host \"Build completed for $arch\" } # Setup Visual Studio environment function Set-VSEnvironment { param ( [string]$arch ) $VS_PATH = \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\" $VS_TOOLS = \"$VS_PATH\\VC\\Auxiliary\\Build\" if (Test-Path \"$VS_TOOLS\\vcvarsall.bat\") { Write-Host \"Setting up Visual Studio environment for $arch...\" $vcvarsArch = if ($arch -eq \"arm64\") { \"x64_arm64\" } else { \"x64\" } cmd.exe /c \"call `\"$VS_TOOLS\\vcvarsall.bat`\" $vcvarsArch \u0026\u0026 set \u003e %temp%\\vcvars.txt\" Get-Content \"$env:temp\\vcvars.txt\" | foreach-object { if ($_ -match \"^(.*?)=(.*)$\") { Set-Content \"env:\\$($matches[1])\" $matches[2] } } } else { Write-Error \"Visual Studio environment setup failed\" exit 1 } } # Main execution logic Write-Host \"OpenCV Build Script\" Write-Host \"Action: $Action\" Write-Host \"Platform: $Platform\" # Handle clean action if ($Action -eq 'clean') { if ($Platform -eq 'all' -or $Platform -eq 'x64') { Clean-Build -arch \"x64\" } if ($Platform -eq 'all' -or $Platform -eq 'arm64') { Clean-Build -arch \"arm64\" } exit 0 } # Handle build action Get-OpenCVSource if ($Platform -eq 'all' -or $Platform -eq 'x64') { Set-VSEnvironment -arch \"x64\" Build-OpenCV -arch \"x64\" -generator \"Visual Studio 17 2022\" -platform \"x64\" } if ($Platform -eq 'all' -or $Platform -eq 'arm64') { Set-VSEnvironment -arch \"arm64\" Build-OpenCV -arch \"arm64\" -generator \"Visual Studio 17 2022\" -platform \"ARM64\" } Write-Host \"Script completed successfully\" 수정된 스크립트 사용 방법:\n기본 빌드 (x64와 arm64 모두): .\\opencv-build.ps1 특정 플랫폼만 빌드: .\\opencv-build.ps1 -Platform x64 .\\opencv-build.ps1 -Platform arm64 빌드 디렉토리 정리: .\\opencv-build.ps1 -Action clean -Platform all .\\opencv-build.ps1 -Action clean -Platform x64 .\\opencv-build.ps1 -Action clean -Platform arm64 주요 변경사항:\n파라미터 추가\nAction: ‘build’ 또는 ‘clean’ (기본값: ‘build’) Platform: ‘x64’, ‘arm64’, ‘all’ (기본값: ‘all’) 함수 모듈화\nClean-Build: 빌드 디렉토리 정리 Get-OpenCVSource: 소스 코드 다운로드 Set-VSEnvironment: Visual Studio 환경 설정 Build-OpenCV: 실제 빌드 수행 진행 상황 표시 개선\n각 단계별 진행 상황을 명확하게 표시 오류 발생 시 상세 메시지 출력 에러 처리 강화\n각 단계별 오류 검사 Visual Studio 환경 설정 실패 시 적절한 처리 스크립트는 기본적으로 빌드 모드로 동작하며, 모든 플랫폼을 빌드합니다. 필요한 경우 파라미터를 통해 특정 동작이나 플랫폼을 지정할 수 있습니다.\ncov-build Coverity build capture와 PowerShell 스크립트를 함께 사용하기 위해서는 명령어 형식을 수정해야 합니다. 여기 두 가지 해결 방법이 있습니다:\nPowerShell 실행기를 명시적으로 지정: cov-build --dir .\\opencv_build\\idir powershell.exe -File .\\opencv-build.ps1 CMD를 통해 실행: cov-build --dir .\\opencv_build\\idir cmd /c \"powershell.exe -File .\\opencv-build.ps1\" 또는 빌드 스크립트를 배치 파일로 래핑하는 방법도 있습니다:\n새로운 파일 build-wrapper.bat 생성: @echo off powershell.exe -File \"%~dp0opencv-build.ps1\" %* 이후 다음과 같이 실행: cov-build --dir .\\opencv_build\\idir .\\build-wrapper.bat 참고:\n%~dp0는 배치 파일이 있는 디렉토리의 경로를 나타냅니다. %*는 모든 커맨드 라인 인자를 전달합니다. 위의 방법들 중 첫 번째 방법(PowerShell 실행기를 직접 지정)을 사용하는 것을 추천합니다. 이 방법이 가장 직관적이고 간단합니다.\nw64devkit w64devkit 환경을 위한 bash 스크립트로 변환하겠습니다.\n#!/bin/bash # Configuration OPENCV_VERSION=\"4.9.0\" SCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" \u0026\u0026 pwd)\" SOURCE_DIR=\"${SCRIPT_DIR}/opencv_source\" BUILD_BASE_DIR=\"${SCRIPT_DIR}/opencv_build\" INSTALL_BASE_DIR=\"${SCRIPT_DIR}/opencv_install\" W64DEVKIT_DIR=\"C:/workspace/dev_tool/w64devkit\" # Default values ACTION=\"build\" PLATFORM=\"all\" USE_COVERITY=0 # Help function show_help() { echo \"Usage: $0 [options]\" echo \"Options:\" echo \" -a, --action Action to perform (build/clean) [default: build]\" echo \" -p, --platform Platform to build (x64/arm64/all) [default: all]\" echo \" -c, --coverity Enable Coverity build\" echo \" -h, --help Show this help message\" } # Parse arguments while [[ $# -gt 0 ]]; do case $1 in -a|--action) ACTION=\"$2\" shift 2 ;; -p|--platform) PLATFORM=\"$2\" shift 2 ;; -c|--coverity) USE_COVERITY=1 shift ;; -h|--help) show_help exit 0 ;; *) echo \"Unknown option: $1\" show_help exit 1 ;; esac done # Validate arguments if [[ ! \"$ACTION\" =~ ^(build|clean)$ ]]; then echo \"Invalid action: $ACTION\" exit 1 fi if [[ ! \"$PLATFORM\" =~ ^(x64|arm64|all)$ ]]; then echo \"Invalid platform: $PLATFORM\" exit 1 fi # Setup environment export PATH=\"${W64DEVKIT_DIR}/bin:$PATH\" export CC=\"${W64DEVKIT_DIR}/bin/gcc.exe\" export CXX=\"${W64DEVKIT_DIR}/bin/g++.exe\" # Common CMake parameters CMAKE_COMMON_PARAMS=( \"-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10\" \"-DBUILD_SHARED_LIBS=ON\" \"-DBUILD_TESTS=OFF\" \"-DBUILD_PERF_TESTS=OFF\" \"-DBUILD_EXAMPLES=OFF\" \"-DWITH_CUDA=OFF\" \"-DBUILD_opencv_world=ON\" \"-DBUILD_opencv_python2=OFF\" \"-DBUILD_opencv_python3=OFF\" \"-DWITH_IPP=ON\" \"-DENABLE_CXX11=ON\" \"-DOPENCV_ENABLE_NONFREE=ON\" \"-DBUILD_WITH_STATIC_CRT=OFF\" \"-DCMAKE_BUILD_TYPE=Release\" ) # Clean function clean_build() { local arch=\"$1\" local build_dir=\"${BUILD_BASE_DIR}/${arch}\" local install_dir=\"${INSTALL_BASE_DIR}/${arch}\" echo \"Cleaning ${arch} build directories...\" if [ -d \"$build_dir\" ]; then rm -rf \"$build_dir\" echo \"Removed build directory: $build_dir\" fi if [ -d \"$install_dir\" ]; then rm -rf \"$install_dir\" echo \"Removed install directory: $install_dir\" fi } # Download OpenCV source get_opencv_source() { if [ ! -d \"$SOURCE_DIR\" ]; then echo \"Cloning OpenCV repository...\" git clone https://github.com/opencv/opencv.git \"$SOURCE_DIR\" pushd \"$SOURCE_DIR\" \u003e /dev/null git checkout \"$OPENCV_VERSION\" popd \u003e /dev/null fi } # Build function build_opencv() { local arch=\"$1\" local build_dir=\"${BUILD_BASE_DIR}/${arch}\" local install_dir=\"${INSTALL_BASE_DIR}/${arch}\" echo \"Building OpenCV for ${arch}...\" # Create build directory mkdir -p \"$build_dir\" pushd \"$build_dir\" \u003e /dev/null # Configure CMake echo \"Configuring CMake for ${arch}...\" local cmake_cmd=\"cmake -G 'Unix Makefiles' \\ -DCMAKE_INSTALL_PREFIX='${install_dir}' \\ ${CMAKE_COMMON_PARAMS[@]} \\ '${SOURCE_DIR}'\" if [ $USE_COVERITY -eq 1 ]; then echo \"Using Coverity Build...\" cov-build --dir \"./opencv_build/idir\" eval \"$cmake_cmd\" else eval \"$cmake_cmd\" fi if [ $? -ne 0 ]; then echo \"CMake configuration failed for ${arch}\" popd \u003e /dev/null exit 1 fi # Build and install echo \"Building and installing for ${arch}...\" local build_cmd=\"make -j8 install\" if [ $USE_COVERITY -eq 1 ]; then cov-build --dir \"./opencv_build/idir\" eval \"$build_cmd\" else eval \"$build_cmd\" fi if [ $? -ne 0 ]; then echo \"Build failed for ${arch}\" popd \u003e /dev/null exit 1 fi popd \u003e /dev/null echo \"Build completed for ${arch}\" } # Main execution echo \"OpenCV Build Script\" echo \"Script Directory: $SCRIPT_DIR\" echo \"Action: $ACTION\" echo \"Platform: $PLATFORM\" echo \"Coverity: $USE_COVERITY\" # Handle clean action if [ \"$ACTION\" = \"clean\" ]; then if [ \"$PLATFORM\" = \"all\" ] || [ \"$PLATFORM\" = \"x64\" ]; then clean_build \"x64\" fi if [ \"$PLATFORM\" = \"all\" ] || [ \"$PLATFORM\" = \"arm64\" ]; then clean_build \"arm64\" fi exit 0 fi # Handle build action get_opencv_source if [ \"$PLATFORM\" = \"all\" ] || [ \"$PLATFORM\" = \"x64\" ]; then build_opencv \"x64\" fi if [ \"$PLATFORM\" = \"all\" ] || [ \"$PLATFORM\" = \"arm64\" ]; then build_opencv \"arm64\" fi echo \"Script completed successfully\" 사용 방법:\n기본 빌드 (모든 플랫폼): ./opencv-build.sh 특정 플랫폼 빌드: ./opencv-build.sh --platform x64 ./opencv-build.sh --platform arm64 클린 빌드: ./opencv-build.sh --action clean ./opencv-build.sh --action clean --platform x64 Coverity 빌드: ./opencv-build.sh --coverity 주요 변경사항:\nw64devkit 환경 설정 추가\nPATH 설정 컴파일러 설정 (GCC/G++) Unix Makefiles 제너레이터 사용\nVisual Studio 대신 GCC 기반 빌드 bash 스크립트 스타일로 변환\n인자 파싱 함수 정의 경로 처리 빌드 시스템 변경\nmake 사용 병렬 빌드 (-j8) 주의사항:\n스크립트를 실행하기 전에 실행 권한을 부여해야 합니다: chmod +x opencv-build.sh w64devkit의 경로가 다른 경우 W64DEVKIT_DIR 변수를 수정해야 합니다.\n경로에 공백이 있는 경우 적절히 따옴표로 감싸져 있는지 확인하세요.\nGit이 w64devkit 환경에서 사용 가능한지 확인하세요.\n이 스크립트는 w64devkit 환경에서 OpenCV를 빌드하는데 최적화되어 있습니다.\nbash shell to use windows compiler, not gcc Visual Studio에서 제공하는 cl 컴파일러 또는 clang-cl을 사용하여 OpenCV를 빌드하도록 스크립트를 수정하겠습니다. 주요 변경 사항은 다음과 같습니다:\n컴파일러 및 도구 체인 설정:\ngcc/g++ 대신 cl 또는 clang-cl을 사용합니다. CMake의 생성기(Generator)를 Visual Studio용으로 변경합니다. 빌드 시스템 변경:\nmake 대신 MSBuild를 사용하여 솔루션 파일(*.sln)을 빌드합니다. 환경 변수 설정:\nVisual Studio의 환경을 초기화하기 위해 vcvarsall.bat를 호출합니다. 플랫폼별 빌드 지원:\nx64와 ARM64 아키텍처를 명시적으로 지정합니다. 수정된 스크립트 #!/bin/bash # Configuration OPENCV_VERSION=\"4.9.0\" SCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" \u0026\u0026 pwd)\" SOURCE_DIR=\"${SCRIPT_DIR}/opencv_source\" BUILD_BASE_DIR=\"${SCRIPT_DIR}/opencv_build\" INSTALL_BASE_DIR=\"${SCRIPT_DIR}/opencv_install\" VISUAL_STUDIO_PATH=\"C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Auxiliary/Build\" # Default values ACTION=\"build\" PLATFORM=\"all\" USE_COVERITY=0 # Help function show_help() { echo \"Usage: $0 [options]\" echo \"Options:\" echo \" -a, --action Action to perform (build/clean) [default: build]\" echo \" -p, --platform Platform to build (x64/arm64/all) [default: all]\" echo \" -c, --coverity Enable Coverity build\" echo \" -h, --help Show this help message\" } # Parse arguments while [[ $# -gt 0 ]]; do case $1 in -a|--action) ACTION=\"$2\" shift 2 ;; -p|--platform) PLATFORM=\"$2\" shift 2 ;; -c|--coverity) USE_COVERITY=1 shift ;; -h|--help) show_help exit 0 ;; *) echo \"Unknown option: $1\" show_help exit 1 ;; esac done # Validate arguments if [[ ! \"$ACTION\" =~ ^(build|clean)$ ]]; then echo \"Invalid action: $ACTION\" exit 1 fi if [[ ! \"$PLATFORM\" =~ ^(x64|arm64|all)$ ]]; then echo \"Invalid platform: $PLATFORM\" exit 1 fi # Setup environment setup_visual_studio_env() { local arch=\"$1\" if [[ \"$arch\" == \"x64\" ]]; then cmd //c \"call \\\"${VISUAL_STUDIO_PATH}/vcvarsall.bat\\\" x64 \u0026\u0026 set \u003e env.txt\" elif [[ \"$arch\" == \"arm64\" ]]; then cmd //c \"call \\\"${VISUAL_STUDIO_PATH}/vcvarsall.bat\\\" arm64 \u0026\u0026 set \u003e env.txt\" fi while read -r line; do export \"$line\" done \u003c env.txt rm env.txt } # Common CMake parameters CMAKE_COMMON_PARAMS=( \"-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10\" \"-DBUILD_SHARED_LIBS=ON\" \"-DBUILD_TESTS=OFF\" \"-DBUILD_PERF_TESTS=OFF\" \"-DBUILD_EXAMPLES=OFF\" \"-DWITH_CUDA=OFF\" \"-DBUILD_opencv_world=ON\" \"-DBUILD_opencv_python2=OFF\" \"-DBUILD_opencv_python3=OFF\" \"-DWITH_IPP=ON\" \"-DENABLE_CXX11=ON\" \"-DOPENCV_ENABLE_NONFREE=ON\" \"-DBUILD_WITH_STATIC_CRT=OFF\" \"-DCMAKE_BUILD_TYPE=Release\" ) # Clean function clean_build() { local arch=\"$1\" local build_dir=\"${BUILD_BASE_DIR}/${arch}\" local install_dir=\"${INSTALL_BASE_DIR}/${arch}\" echo \"Cleaning ${arch} build directories...\" if [ -d \"$build_dir\" ]; then rm -rf \"$build_dir\" echo \"Removed build directory: $build_dir\" fi if [ -d \"$install_dir\" ]; then rm -rf \"$install_dir\" echo \"Removed install directory: $install_dir\" fi } # Download OpenCV source get_opencv_source() { if [ ! -d \"$SOURCE_DIR\" ]; then echo \"Cloning OpenCV repository...\" git clone https://github.com/opencv/opencv.git \"$SOURCE_DIR\" pushd \"$SOURCE_DIR\" \u003e /dev/null git checkout \"$OPENCV_VERSION\" popd \u003e /dev/null fi } # Build function build_opencv() { local arch=\"$1\" local build_dir=\"${BUILD_BASE_DIR}/${arch}\" local install_dir=\"${INSTALL_BASE_DIR}/${arch}\" echo \"Building OpenCV for ${arch}...\" # Set up Visual Studio environment setup_visual_studio_env \"$arch\" # Create build directory mkdir -p \"$build_dir\" pushd \"$build_dir\" \u003e /dev/null # Configure CMake echo \"Configuring CMake for ${arch}...\" local cmake_cmd=\"cmake -G 'Visual Studio 17 2022' \\ -A $arch \\ -DCMAKE_INSTALL_PREFIX='${install_dir}' \\ ${CMAKE_COMMON_PARAMS[@]} \\ '${SOURCE_DIR}'\" if [ $USE_COVERITY -eq 1 ]; then echo \"Using Coverity Build...\" cov-build --dir \"./opencv_build/idir\" eval \"$cmake_cmd\" else eval \"$cmake_cmd\" fi if [ $? -ne 0 ]; then echo \"CMake configuration failed for ${arch}\" popd \u003e /dev/null exit 1 fi # Build and install echo \"Building and installing for ${arch}...\" local build_cmd=\"MSBuild OpenCV.sln /p:Configuration=Release /p:Platform=$arch /m\" if [ $USE_COVERITY -eq 1 ]; then cov-build --dir \"./opencv_build/idir\" eval \"$build_cmd\" else eval \"$build_cmd\" fi if [ $? -ne 0 ]; then echo \"Build failed for ${arch}\" popd \u003e /dev/null exit 1 fi # Install cmake --install . --config Release popd \u003e /dev/null echo \"Build completed for ${arch}\" } # Main execution echo \"OpenCV Build Script\" echo \"Script Directory: $SCRIPT_DIR\" echo \"Action: $ACTION\" echo \"Platform: $PLATFORM\" echo \"Coverity: $USE_COVERITY\" # Handle clean action if [ \"$ACTION\" = \"clean\" ]; then if [ \"$PLATFORM\" = \"all\" ] || [ \"$PLATFORM\" = \"x64\" ]; then clean_build \"x64\" fi if [ \"$PLATFORM\" = \"all\" ] || [ \"$PLATFORM\" = \"arm64\" ]; then clean_build \"arm64\" fi exit 0 fi # Handle build action get_opencv_source if [ \"$PLATFORM\" = \"all\" ] || [ \"$PLATFORM\" = \"x64\" ]; then build_opencv \"x64\" fi if [ \"$PLATFORM\" = \"all\" ] || [ \"$PLATFORM\" = \"arm64\" ]; then build_opencv \"arm64\" fi echo \"Script completed successfully\" 주요 변경 사항 설명 Visual Studio 환경 설정:\nvcvarsall.bat를 호출하여 x64 또는 ARM64 환경을 초기화합니다. 환경 변수를 읽어 Bash에서 사용할 수 있도록 처리합니다. CMake 생성기 변경:\n-G 'Visual Studio 17 2022'를 사용하여 Visual Studio 프로젝트를 생성합니다. -A $arch로 플랫폼(x64 또는 ARM64)을 명시합니다. 빌드 시스템 변경:\nMSBuild를 사용하여 .sln 파일을 빌드합니다. /p:Configuration=Release와 /p:Platform=$arch로 빌드 옵션을 설정합니다. Coverity 지원:\nCoverity를 사용하는 경우에도 동일한 방식으로 적용됩니다. 사용 방법 스크립트를 저장하고 실행 권한을 부여합니다:\nchmod +x build_opencv.sh 스크립트를 실행합니다:\n./build_opencv.sh -a build -p all 필요한 경우 -c 옵션으로 Coverity 빌드를 활성화합니다:\n./build_opencv.sh -a build -p x64 -c 이 스크립트를 통해 Visual Studio의 cl 또는 clang-cl을 사용하여 OpenCV를 성공적으로 빌드할 수 있습니다.\n","wordCount":"2519","inLanguage":"ko","datePublished":"2025-02-20T00:00:00Z","dateModified":"2025-02-20T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://jongyongpark.github.io/posts/developer/opencv-win/"},"publisher":{"@type":"Organization","name":"RyanLabs","logo":{"@type":"ImageObject","url":"https://jongyongpark.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jongyongpark.github.io/ accesskey=h title="RyanLabs (Alt + H)">RyanLabs</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://jongyongpark.github.io/search/ title=검색><span>검색</span></a></li><li><a href=https://jongyongpark.github.io/categories/ title=카테고리><span>카테고리</span></a></li><li><a href=https://jongyongpark.github.io/tags/ title=태그><span>태그</span></a></li><li><a href=https://jongyongpark.github.io/archives/ title=연도><span>연도</span></a></li><li><a href=https://jongyongpark.github.io/lectures/ title=강의><span>강의</span></a></li><li><a href=https://jongyongpark.github.io/about/ title=어바웃미><span>어바웃미</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">OpenCV compile on Windows</h1><div class=post-meta><span title='2025-02-20 00:00:00 +0000 UTC'>2월 20, 2025</span></div></header><div class=post-content><h1 id=claude>Claude<a hidden class=anchor aria-hidden=true href=#claude>#</a></h1><p>이 오류는 ARM64 플랫폼을 위한 CMake 구성 과정에서 발생한 문제입니다. 주요 오류는 프로젝트 설정이 제대로 되지 않았고, ARM64 플랫폼 구성이 올바르지 않다는 것입니다.</p><p>PowerShell 스크립트를 다음과 같이 수정하여 해결할 수 있습니다:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># OpenCV Windows Build Script for x64 and ARM64</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Prerequisites: Visual Studio 2022, CMake, Git</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Configuration</span>
</span></span><span style=display:flex><span>$OPENCV_VERSION = <span style=color:#e6db74>&#34;4.9.0&#34;</span>
</span></span><span style=display:flex><span>$SOURCE_DIR = <span style=color:#e6db74>&#34;C:\workspace\jonpark-work\opencv_source&#34;</span>
</span></span><span style=display:flex><span>$BUILD_BASE_DIR = <span style=color:#e6db74>&#34;C:\workspace\jonpark-work\opencv_build&#34;</span>
</span></span><span style=display:flex><span>$INSTALL_BASE_DIR = <span style=color:#e6db74>&#34;C:\workspace\jonpark-work\opencv_install&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Common CMake parameters</span>
</span></span><span style=display:flex><span>$CMAKE_COMMON_PARAMS = @(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10&#34;</span>,  <span style=color:#75715e># 최소 CMake 버전 지정</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_SHARED_LIBS=ON&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_TESTS=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_PERF_TESTS=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_EXAMPLES=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DWITH_CUDA=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_world=ON&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_python2=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_python3=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DWITH_IPP=ON&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DENABLE_CXX11=ON&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DOPENCV_ENABLE_NONFREE=ON&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_WITH_STATIC_CRT=OFF&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Download OpenCV source</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>-not</span> (Test-Path $SOURCE_DIR)) {
</span></span><span style=display:flex><span>    git clone https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/opencv/opencv.git $SOURCE_DIR
</span></span><span style=display:flex><span>    Push-Location $SOURCE_DIR
</span></span><span style=display:flex><span>    git checkout $OPENCV_VERSION
</span></span><span style=display:flex><span>    Pop-Location
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Function to build OpenCV for specific architecture</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> Build-OpenCV {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>param</span> (
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$arch,
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$generator,
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$platform
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $BUILD_DIR = <span style=color:#e6db74>&#34;</span>$BUILD_BASE_DIR<span style=color:#e6db74>\</span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    $INSTALL_DIR = <span style=color:#e6db74>&#34;</span>$INSTALL_BASE_DIR<span style=color:#e6db74>\</span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Remove existing build directory to ensure clean build</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Test-Path $BUILD_DIR) {
</span></span><span style=display:flex><span>        Remove-Item -Path $BUILD_DIR -Recurse -Force
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create build directory</span>
</span></span><span style=display:flex><span>    New-Item -ItemType Directory -Force -Path $BUILD_DIR
</span></span><span style=display:flex><span>    Push-Location $BUILD_DIR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Configure CMake with explicit project name and build type</span>
</span></span><span style=display:flex><span>    cmake -G $generator -A $platform `
</span></span><span style=display:flex><span>        -DCMAKE_INSTALL_PREFIX=<span style=color:#e6db74>&#34;</span>$INSTALL_DIR<span style=color:#e6db74>&#34;</span> `
</span></span><span style=display:flex><span>        -DCMAKE_BUILD_TYPE=Release `
</span></span><span style=display:flex><span>        -DOpenCV_ARCH=$platform `
</span></span><span style=display:flex><span>        -DOpenCV_RUNTIME=vc17 `
</span></span><span style=display:flex><span>        $CMAKE_COMMON_PARAMS `
</span></span><span style=display:flex><span>        -S $SOURCE_DIR -B $BUILD_DIR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($LASTEXITCODE <span style=color:#f92672>-ne</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        Write-Error <span style=color:#e6db74>&#34;CMake configuration failed for </span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        Pop-Location
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Build and install</span>
</span></span><span style=display:flex><span>    cmake --build $BUILD_DIR --config Release --target INSTALL --parallel <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($LASTEXITCODE <span style=color:#f92672>-ne</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        Write-Error <span style=color:#e6db74>&#34;Build failed for </span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        Pop-Location
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Pop-Location
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 빌드 전 Visual Studio 환경 설정</span>
</span></span><span style=display:flex><span>$VS_PATH = <span style=color:#e6db74>&#34;C:\Program Files\Microsoft Visual Studio\2022\Community&#34;</span>
</span></span><span style=display:flex><span>$VS_TOOLS = <span style=color:#e6db74>&#34;</span>$VS_PATH<span style=color:#e6db74>\VC\Auxiliary\Build&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (Test-Path <span style=color:#e6db74>&#34;</span>$VS_TOOLS<span style=color:#e6db74>\vcvarsall.bat&#34;</span>) {
</span></span><span style=display:flex><span>    Write-Host <span style=color:#e6db74>&#34;Setting up Visual Studio environment...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># x64 환경 설정</span>
</span></span><span style=display:flex><span>    cmd.exe /c <span style=color:#e6db74>&#34;call </span><span style=color:#ae81ff>`&#34;</span>$VS_TOOLS<span style=color:#e6db74>\vcvarsall.bat</span><span style=color:#ae81ff>`&#34;</span><span style=color:#e6db74> x64 &amp;&amp; set &gt; %temp%\vcvars.txt&#34;</span>
</span></span><span style=display:flex><span>    Get-Content <span style=color:#e6db74>&#34;</span>$env:temp<span style=color:#e6db74>\vcvars.txt&#34;</span> | foreach-object {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($_ <span style=color:#f92672>-match</span> <span style=color:#e6db74>&#34;^(.*?)=(.*)$&#34;</span>) {
</span></span><span style=display:flex><span>            Set-Content <span style=color:#e6db74>&#34;env:\</span>$($matches[<span style=color:#ae81ff>1</span>])<span style=color:#e6db74>&#34;</span> $matches[<span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    Write-Error <span style=color:#e6db74>&#34;Visual Studio environment setup failed&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Build for x64</span>
</span></span><span style=display:flex><span>Write-Host <span style=color:#e6db74>&#34;Building for x64...&#34;</span>
</span></span><span style=display:flex><span>Build-OpenCV -arch <span style=color:#e6db74>&#34;x64&#34;</span> -generator <span style=color:#e6db74>&#34;Visual Studio 17 2022&#34;</span> -platform <span style=color:#e6db74>&#34;x64&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ARM64 빌드 전 환경 재설정</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (Test-Path <span style=color:#e6db74>&#34;</span>$VS_TOOLS<span style=color:#e6db74>\vcvarsall.bat&#34;</span>) {
</span></span><span style=display:flex><span>    Write-Host <span style=color:#e6db74>&#34;Setting up Visual Studio environment for ARM64...&#34;</span>
</span></span><span style=display:flex><span>    cmd.exe /c <span style=color:#e6db74>&#34;call </span><span style=color:#ae81ff>`&#34;</span>$VS_TOOLS<span style=color:#e6db74>\vcvarsall.bat</span><span style=color:#ae81ff>`&#34;</span><span style=color:#e6db74> x64_arm64 &amp;&amp; set &gt; %temp%\vcvars.txt&#34;</span>
</span></span><span style=display:flex><span>    Get-Content <span style=color:#e6db74>&#34;</span>$env:temp<span style=color:#e6db74>\vcvars.txt&#34;</span> | foreach-object {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($_ <span style=color:#f92672>-match</span> <span style=color:#e6db74>&#34;^(.*?)=(.*)$&#34;</span>) {
</span></span><span style=display:flex><span>            Set-Content <span style=color:#e6db74>&#34;env:\</span>$($matches[<span style=color:#ae81ff>1</span>])<span style=color:#e6db74>&#34;</span> $matches[<span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Build for ARM64</span>
</span></span><span style=display:flex><span>Write-Host <span style=color:#e6db74>&#34;Building for ARM64...&#34;</span>
</span></span><span style=display:flex><span>Build-OpenCV -arch <span style=color:#e6db74>&#34;arm64&#34;</span> -generator <span style=color:#e6db74>&#34;Visual Studio 17 2022&#34;</span> -platform <span style=color:#e6db74>&#34;ARM64&#34;</span>
</span></span></code></pre></div><p>주요 변경사항과 해결방법:</p><ol><li><p>Visual Studio 환경 설정 추가</p><ul><li><code>vcvarsall.bat</code>을 사용하여 적절한 빌드 환경 설정</li><li>x64와 ARM64 각각에 대해 별도의 환경 설정</li></ul></li><li><p>CMake 구성 개선</p><ul><li>명시적으로 프로젝트 소스와 빌드 디렉토리 지정 (-S, -B 옵션)</li><li>CMAKE_BUILD_TYPE을 명시적으로 지정</li><li>OpenCV 관련 추가 파라미터 설정</li></ul></li><li><p>빌드 디렉토리 정리</p><ul><li>빌드 전 기존 디렉토리 제거하여 클린 빌드 보장</li></ul></li><li><p>오류 처리 개선</p><ul><li>CMake 구성과 빌드 단계에서의 오류 확인</li><li>실패 시 적절한 오류 메시지 출력</li></ul></li></ol><p>스크립트 실행 방법:</p><ol><li>PowerShell을 관리자 권한으로 실행</li><li>스크립트가 있는 디렉토리로 이동</li><li><code>.\opencv-build.ps1</code> 실행</li></ol><p>이 수정된 스크립트는 이전 오류들을 해결하고, 더 안정적인 빌드 프로세스를 제공합니다.</p><h1 id=인자로-옶션-받도록-수정>인자로 옶션 받도록 수정<a hidden class=anchor aria-hidden=true href=#인자로-옶션-받도록-수정>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># OpenCV Windows Build Script for x64 and ARM64</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>param</span> (
</span></span><span style=display:flex><span>    [Parameter()]
</span></span><span style=display:flex><span>    [ValidateSet(<span style=color:#e6db74>&#39;build&#39;</span>, <span style=color:#e6db74>&#39;clean&#39;</span>)]
</span></span><span style=display:flex><span>    [<span style=color:#66d9ef>string</span>]$Action = <span style=color:#e6db74>&#39;build&#39;</span>,
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    [Parameter()]
</span></span><span style=display:flex><span>    [ValidateSet(<span style=color:#e6db74>&#39;x64&#39;</span>, <span style=color:#e6db74>&#39;arm64&#39;</span>, <span style=color:#e6db74>&#39;all&#39;</span>)]
</span></span><span style=display:flex><span>    [<span style=color:#66d9ef>string</span>]$Platform = <span style=color:#e6db74>&#39;all&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Configuration</span>
</span></span><span style=display:flex><span>$OPENCV_VERSION = <span style=color:#e6db74>&#34;4.9.0&#34;</span>
</span></span><span style=display:flex><span>$SOURCE_DIR = <span style=color:#e6db74>&#34;C:\workspace\jonpark-work\opencv_source&#34;</span>
</span></span><span style=display:flex><span>$BUILD_BASE_DIR = <span style=color:#e6db74>&#34;C:\workspace\jonpark-work\opencv_build&#34;</span>
</span></span><span style=display:flex><span>$INSTALL_BASE_DIR = <span style=color:#e6db74>&#34;C:\workspace\jonpark-work\opencv_install&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Common CMake parameters</span>
</span></span><span style=display:flex><span>$CMAKE_COMMON_PARAMS = @(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_SHARED_LIBS=ON&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_TESTS=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_PERF_TESTS=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_EXAMPLES=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DWITH_CUDA=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_world=ON&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_python2=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_python3=OFF&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DWITH_IPP=ON&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DENABLE_CXX11=ON&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DOPENCV_ENABLE_NONFREE=ON&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_WITH_STATIC_CRT=OFF&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Clean function</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> Clean-Build {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>param</span> (
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$arch
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    $BUILD_DIR = <span style=color:#e6db74>&#34;</span>$BUILD_BASE_DIR<span style=color:#e6db74>\</span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    $INSTALL_DIR = <span style=color:#e6db74>&#34;</span>$INSTALL_BASE_DIR<span style=color:#e6db74>\</span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    Write-Host <span style=color:#e6db74>&#34;Cleaning </span>$arch<span style=color:#e6db74> build directories...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Test-Path $BUILD_DIR) {
</span></span><span style=display:flex><span>        Remove-Item -Path $BUILD_DIR -Recurse -Force
</span></span><span style=display:flex><span>        Write-Host <span style=color:#e6db74>&#34;Removed build directory: </span>$BUILD_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Test-Path $INSTALL_DIR) {
</span></span><span style=display:flex><span>        Remove-Item -Path $INSTALL_DIR -Recurse -Force
</span></span><span style=display:flex><span>        Write-Host <span style=color:#e6db74>&#34;Removed install directory: </span>$INSTALL_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Download OpenCV source</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> Get-OpenCVSource {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>-not</span> (Test-Path $SOURCE_DIR)) {
</span></span><span style=display:flex><span>        Write-Host <span style=color:#e6db74>&#34;Cloning OpenCV repository...&#34;</span>
</span></span><span style=display:flex><span>        git clone https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/opencv/opencv.git $SOURCE_DIR
</span></span><span style=display:flex><span>        Push-Location $SOURCE_DIR
</span></span><span style=display:flex><span>        git checkout $OPENCV_VERSION
</span></span><span style=display:flex><span>        Pop-Location
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Function to build OpenCV for specific architecture</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> Build-OpenCV {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>param</span> (
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$arch,
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$generator,
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$platform
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $BUILD_DIR = <span style=color:#e6db74>&#34;</span>$BUILD_BASE_DIR<span style=color:#e6db74>\</span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    $INSTALL_DIR = <span style=color:#e6db74>&#34;</span>$INSTALL_BASE_DIR<span style=color:#e6db74>\</span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Write-Host <span style=color:#e6db74>&#34;Building OpenCV for </span>$arch<span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create build directory</span>
</span></span><span style=display:flex><span>    New-Item -ItemType Directory -Force -Path $BUILD_DIR
</span></span><span style=display:flex><span>    Push-Location $BUILD_DIR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Configure CMake with explicit project name and build type</span>
</span></span><span style=display:flex><span>    Write-Host <span style=color:#e6db74>&#34;Configuring CMake for </span>$arch<span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    cmake -G $generator -A $platform `
</span></span><span style=display:flex><span>        -DCMAKE_INSTALL_PREFIX=<span style=color:#e6db74>&#34;</span>$INSTALL_DIR<span style=color:#e6db74>&#34;</span> `
</span></span><span style=display:flex><span>        -DCMAKE_BUILD_TYPE=Release `
</span></span><span style=display:flex><span>        -DOpenCV_ARCH=$platform `
</span></span><span style=display:flex><span>        -DOpenCV_RUNTIME=vc17 `
</span></span><span style=display:flex><span>        $CMAKE_COMMON_PARAMS `
</span></span><span style=display:flex><span>        -S $SOURCE_DIR -B $BUILD_DIR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($LASTEXITCODE <span style=color:#f92672>-ne</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        Write-Error <span style=color:#e6db74>&#34;CMake configuration failed for </span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        Pop-Location
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Build and install</span>
</span></span><span style=display:flex><span>    Write-Host <span style=color:#e6db74>&#34;Building and installing for </span>$arch<span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    cmake --build $BUILD_DIR --config Release --target INSTALL --parallel <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($LASTEXITCODE <span style=color:#f92672>-ne</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        Write-Error <span style=color:#e6db74>&#34;Build failed for </span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        Pop-Location
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Pop-Location
</span></span><span style=display:flex><span>    Write-Host <span style=color:#e6db74>&#34;Build completed for </span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Setup Visual Studio environment</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> Set-VSEnvironment {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>param</span> (
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$arch
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    $VS_PATH = <span style=color:#e6db74>&#34;C:\Program Files\Microsoft Visual Studio\2022\Community&#34;</span>
</span></span><span style=display:flex><span>    $VS_TOOLS = <span style=color:#e6db74>&#34;</span>$VS_PATH<span style=color:#e6db74>\VC\Auxiliary\Build&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Test-Path <span style=color:#e6db74>&#34;</span>$VS_TOOLS<span style=color:#e6db74>\vcvarsall.bat&#34;</span>) {
</span></span><span style=display:flex><span>        Write-Host <span style=color:#e6db74>&#34;Setting up Visual Studio environment for </span>$arch<span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>        $vcvarsArch = <span style=color:#66d9ef>if</span> ($arch <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#34;arm64&#34;</span>) { <span style=color:#e6db74>&#34;x64_arm64&#34;</span> } <span style=color:#66d9ef>else</span> { <span style=color:#e6db74>&#34;x64&#34;</span> }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        cmd.exe /c <span style=color:#e6db74>&#34;call </span><span style=color:#ae81ff>`&#34;</span>$VS_TOOLS<span style=color:#e6db74>\vcvarsall.bat</span><span style=color:#ae81ff>`&#34;</span><span style=color:#e6db74> </span>$vcvarsArch<span style=color:#e6db74> &amp;&amp; set &gt; %temp%\vcvars.txt&#34;</span>
</span></span><span style=display:flex><span>        Get-Content <span style=color:#e6db74>&#34;</span>$env:temp<span style=color:#e6db74>\vcvars.txt&#34;</span> | foreach-object {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> ($_ <span style=color:#f92672>-match</span> <span style=color:#e6db74>&#34;^(.*?)=(.*)$&#34;</span>) {
</span></span><span style=display:flex><span>                Set-Content <span style=color:#e6db74>&#34;env:\</span>$($matches[<span style=color:#ae81ff>1</span>])<span style=color:#e6db74>&#34;</span> $matches[<span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        Write-Error <span style=color:#e6db74>&#34;Visual Studio environment setup failed&#34;</span>
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Main execution logic</span>
</span></span><span style=display:flex><span>Write-Host <span style=color:#e6db74>&#34;OpenCV Build Script&#34;</span>
</span></span><span style=display:flex><span>Write-Host <span style=color:#e6db74>&#34;Action: </span>$Action<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>Write-Host <span style=color:#e6db74>&#34;Platform: </span>$Platform<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Handle clean action</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($Action <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;clean&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($Platform <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;all&#39;</span> <span style=color:#f92672>-or</span> $Platform <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;x64&#39;</span>) {
</span></span><span style=display:flex><span>        Clean-Build -arch <span style=color:#e6db74>&#34;x64&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($Platform <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;all&#39;</span> <span style=color:#f92672>-or</span> $Platform <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;arm64&#39;</span>) {
</span></span><span style=display:flex><span>        Clean-Build -arch <span style=color:#e6db74>&#34;arm64&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Handle build action</span>
</span></span><span style=display:flex><span>Get-OpenCVSource
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($Platform <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;all&#39;</span> <span style=color:#f92672>-or</span> $Platform <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;x64&#39;</span>) {
</span></span><span style=display:flex><span>    Set-VSEnvironment -arch <span style=color:#e6db74>&#34;x64&#34;</span>
</span></span><span style=display:flex><span>    Build-OpenCV -arch <span style=color:#e6db74>&#34;x64&#34;</span> -generator <span style=color:#e6db74>&#34;Visual Studio 17 2022&#34;</span> -platform <span style=color:#e6db74>&#34;x64&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($Platform <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;all&#39;</span> <span style=color:#f92672>-or</span> $Platform <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;arm64&#39;</span>) {
</span></span><span style=display:flex><span>    Set-VSEnvironment -arch <span style=color:#e6db74>&#34;arm64&#34;</span>
</span></span><span style=display:flex><span>    Build-OpenCV -arch <span style=color:#e6db74>&#34;arm64&#34;</span> -generator <span style=color:#e6db74>&#34;Visual Studio 17 2022&#34;</span> -platform <span style=color:#e6db74>&#34;ARM64&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Write-Host <span style=color:#e6db74>&#34;Script completed successfully&#34;</span>
</span></span></code></pre></div><p>수정된 스크립트 사용 방법:</p><ol><li>기본 빌드 (x64와 arm64 모두):</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>.\opencv-build.ps1
</span></span></code></pre></div><ol start=2><li>특정 플랫폼만 빌드:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>.\opencv-build.ps1 -Platform x64
</span></span><span style=display:flex><span>.\opencv-build.ps1 -Platform arm64
</span></span></code></pre></div><ol start=3><li>빌드 디렉토리 정리:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>.\opencv-build.ps1 -Action clean -Platform all
</span></span><span style=display:flex><span>.\opencv-build.ps1 -Action clean -Platform x64
</span></span><span style=display:flex><span>.\opencv-build.ps1 -Action clean -Platform arm64
</span></span></code></pre></div><p>주요 변경사항:</p><ol><li><p>파라미터 추가</p><ul><li>Action: &lsquo;build&rsquo; 또는 &lsquo;clean&rsquo; (기본값: &lsquo;build&rsquo;)</li><li>Platform: &lsquo;x64&rsquo;, &lsquo;arm64&rsquo;, &lsquo;all&rsquo; (기본값: &lsquo;all&rsquo;)</li></ul></li><li><p>함수 모듈화</p><ul><li>Clean-Build: 빌드 디렉토리 정리</li><li>Get-OpenCVSource: 소스 코드 다운로드</li><li>Set-VSEnvironment: Visual Studio 환경 설정</li><li>Build-OpenCV: 실제 빌드 수행</li></ul></li><li><p>진행 상황 표시 개선</p><ul><li>각 단계별 진행 상황을 명확하게 표시</li><li>오류 발생 시 상세 메시지 출력</li></ul></li><li><p>에러 처리 강화</p><ul><li>각 단계별 오류 검사</li><li>Visual Studio 환경 설정 실패 시 적절한 처리</li></ul></li></ol><p>스크립트는 기본적으로 빌드 모드로 동작하며, 모든 플랫폼을 빌드합니다. 필요한 경우 파라미터를 통해 특정 동작이나 플랫폼을 지정할 수 있습니다.</p><h1 id=cov-build>cov-build<a hidden class=anchor aria-hidden=true href=#cov-build>#</a></h1><p>Coverity build capture와 PowerShell 스크립트를 함께 사용하기 위해서는 명령어 형식을 수정해야 합니다. 여기 두 가지 해결 방법이 있습니다:</p><ol><li>PowerShell 실행기를 명시적으로 지정:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cov-build --dir .<span style=color:#ae81ff>\o</span>pencv_build<span style=color:#ae81ff>\i</span>dir powershell.exe -File .<span style=color:#ae81ff>\o</span>pencv-build.ps1
</span></span></code></pre></div><ol start=2><li>CMD를 통해 실행:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cov-build --dir .<span style=color:#ae81ff>\o</span>pencv_build<span style=color:#ae81ff>\i</span>dir cmd /c <span style=color:#e6db74>&#34;powershell.exe -File .\opencv-build.ps1&#34;</span>
</span></span></code></pre></div><p>또는 빌드 스크립트를 배치 파일로 래핑하는 방법도 있습니다:</p><ol><li>새로운 파일 <code>build-wrapper.bat</code> 생성:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-batch data-lang=batch><span style=display:flex><span>@<span style=color:#66d9ef>echo</span> off
</span></span><span style=display:flex><span>powershell.exe -File <span style=color:#e6db74>&#34;</span>%~dp0<span style=color:#e6db74>opencv-build.ps1&#34;</span> %*
</span></span></code></pre></div><ol start=2><li>이후 다음과 같이 실행:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cov-build --dir .<span style=color:#ae81ff>\o</span>pencv_build<span style=color:#ae81ff>\i</span>dir .<span style=color:#ae81ff>\b</span>uild-wrapper.bat
</span></span></code></pre></div><p>참고:</p><ul><li><code>%~dp0</code>는 배치 파일이 있는 디렉토리의 경로를 나타냅니다.</li><li><code>%*</code>는 모든 커맨드 라인 인자를 전달합니다.</li></ul><p>위의 방법들 중 첫 번째 방법(PowerShell 실행기를 직접 지정)을 사용하는 것을 추천합니다. 이 방법이 가장 직관적이고 간단합니다.</p><h1 id=w64devkit>w64devkit<a hidden class=anchor aria-hidden=true href=#w64devkit>#</a></h1><p>w64devkit 환경을 위한 bash 스크립트로 변환하겠습니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># Configuration</span>
</span></span><span style=display:flex><span>OPENCV_VERSION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;4.9.0&#34;</span>
</span></span><span style=display:flex><span>SCRIPT_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cd <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>dirname <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BASH_SOURCE[0]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&amp;&amp;</span> pwd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>SOURCE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SCRIPT_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/opencv_source&#34;</span>
</span></span><span style=display:flex><span>BUILD_BASE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SCRIPT_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/opencv_build&#34;</span>
</span></span><span style=display:flex><span>INSTALL_BASE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SCRIPT_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/opencv_install&#34;</span>
</span></span><span style=display:flex><span>W64DEVKIT_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;C:/workspace/dev_tool/w64devkit&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Default values</span>
</span></span><span style=display:flex><span>ACTION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;build&#34;</span>
</span></span><span style=display:flex><span>PLATFORM<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;all&#34;</span>
</span></span><span style=display:flex><span>USE_COVERITY<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Help function</span>
</span></span><span style=display:flex><span>show_help<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Usage: </span>$0<span style=color:#e6db74> [options]&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Options:&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;  -a, --action    Action to perform (build/clean) [default: build]&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;  -p, --platform  Platform to build (x64/arm64/all) [default: all]&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;  -c, --coverity  Enable Coverity build&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;  -h, --help      Show this help message&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Parse arguments</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#f92672>[[</span> $# -gt <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> $1 in
</span></span><span style=display:flex><span>        -a|--action<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            ACTION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            shift <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        -p|--platform<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            PLATFORM<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            shift <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        -c|--coverity<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            USE_COVERITY<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            shift
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        -h|--help<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            show_help
</span></span><span style=display:flex><span>            exit <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        *<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;Unknown option: </span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            show_help
</span></span><span style=display:flex><span>            exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>esac</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Validate arguments</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$ACTION<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span>~ ^<span style=color:#f92672>(</span>build|clean<span style=color:#f92672>)</span>$ <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Invalid action: </span>$ACTION<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span>~ ^<span style=color:#f92672>(</span>x64|arm64|all<span style=color:#f92672>)</span>$ <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Invalid platform: </span>$PLATFORM<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Setup environment</span>
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>W64DEVKIT_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin:</span>$PATH<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>export CC<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>W64DEVKIT_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/gcc.exe&#34;</span>
</span></span><span style=display:flex><span>export CXX<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>W64DEVKIT_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/g++.exe&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Common CMake parameters</span>
</span></span><span style=display:flex><span>CMAKE_COMMON_PARAMS<span style=color:#f92672>=(</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_SHARED_LIBS=ON&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_TESTS=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_PERF_TESTS=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_EXAMPLES=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DWITH_CUDA=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_world=ON&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_python2=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_python3=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DWITH_IPP=ON&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DENABLE_CXX11=ON&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DOPENCV_ENABLE_NONFREE=ON&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_WITH_STATIC_CRT=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DCMAKE_BUILD_TYPE=Release&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Clean function</span>
</span></span><span style=display:flex><span>clean_build<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local build_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BUILD_BASE_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local install_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_BASE_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Cleaning </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74> build directories...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -d <span style=color:#e6db74>&#34;</span>$build_dir<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        rm -rf <span style=color:#e6db74>&#34;</span>$build_dir<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Removed build directory: </span>$build_dir<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -d <span style=color:#e6db74>&#34;</span>$install_dir<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        rm -rf <span style=color:#e6db74>&#34;</span>$install_dir<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Removed install directory: </span>$install_dir<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Download OpenCV source</span>
</span></span><span style=display:flex><span>get_opencv_source<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -d <span style=color:#e6db74>&#34;</span>$SOURCE_DIR<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Cloning OpenCV repository...&#34;</span>
</span></span><span style=display:flex><span>        git clone https://github.com/opencv/opencv.git <span style=color:#e6db74>&#34;</span>$SOURCE_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        pushd <span style=color:#e6db74>&#34;</span>$SOURCE_DIR<span style=color:#e6db74>&#34;</span> &gt; /dev/null
</span></span><span style=display:flex><span>        git checkout <span style=color:#e6db74>&#34;</span>$OPENCV_VERSION<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        popd &gt; /dev/null
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Build function</span>
</span></span><span style=display:flex><span>build_opencv<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local build_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BUILD_BASE_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local install_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_BASE_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Building OpenCV for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create build directory</span>
</span></span><span style=display:flex><span>    mkdir -p <span style=color:#e6db74>&#34;</span>$build_dir<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    pushd <span style=color:#e6db74>&#34;</span>$build_dir<span style=color:#e6db74>&#34;</span> &gt; /dev/null
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Configure CMake</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Configuring CMake for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    local cmake_cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;cmake -G &#39;Unix Makefiles&#39; \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        -DCMAKE_INSTALL_PREFIX=&#39;</span><span style=color:#e6db74>${</span>install_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39; \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        </span><span style=color:#e6db74>${</span>CMAKE_COMMON_PARAMS[@]<span style=color:#e6db74>}</span><span style=color:#e6db74> \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#39;</span><span style=color:#e6db74>${</span>SOURCE_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $USE_COVERITY -eq <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Using Coverity Build...&#34;</span>
</span></span><span style=display:flex><span>        cov-build --dir <span style=color:#e6db74>&#34;./opencv_build/idir&#34;</span> eval <span style=color:#e6db74>&#34;</span>$cmake_cmd<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        eval <span style=color:#e6db74>&#34;</span>$cmake_cmd<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $? -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;CMake configuration failed for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        popd &gt; /dev/null
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Build and install</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Building and installing for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    local build_cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;make -j8 install&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $USE_COVERITY -eq <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        cov-build --dir <span style=color:#e6db74>&#34;./opencv_build/idir&#34;</span> eval <span style=color:#e6db74>&#34;</span>$build_cmd<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        eval <span style=color:#e6db74>&#34;</span>$build_cmd<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $? -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Build failed for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        popd &gt; /dev/null
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    popd &gt; /dev/null
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Build completed for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Main execution</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;OpenCV Build Script&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Script Directory: </span>$SCRIPT_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Action: </span>$ACTION<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Platform: </span>$PLATFORM<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Coverity: </span>$USE_COVERITY<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Handle clean action</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$ACTION<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;clean&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;all&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;x64&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        clean_build <span style=color:#e6db74>&#34;x64&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;all&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;arm64&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        clean_build <span style=color:#e6db74>&#34;arm64&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Handle build action</span>
</span></span><span style=display:flex><span>get_opencv_source
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;all&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;x64&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    build_opencv <span style=color:#e6db74>&#34;x64&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;all&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;arm64&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    build_opencv <span style=color:#e6db74>&#34;arm64&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Script completed successfully&#34;</span>
</span></span></code></pre></div><p>사용 방법:</p><ol><li>기본 빌드 (모든 플랫폼):</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./opencv-build.sh
</span></span></code></pre></div><ol start=2><li>특정 플랫폼 빌드:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./opencv-build.sh --platform x64
</span></span><span style=display:flex><span>./opencv-build.sh --platform arm64
</span></span></code></pre></div><ol start=3><li>클린 빌드:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./opencv-build.sh --action clean
</span></span><span style=display:flex><span>./opencv-build.sh --action clean --platform x64
</span></span></code></pre></div><ol start=4><li>Coverity 빌드:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./opencv-build.sh --coverity
</span></span></code></pre></div><p>주요 변경사항:</p><ol><li><p>w64devkit 환경 설정 추가</p><ul><li>PATH 설정</li><li>컴파일러 설정 (GCC/G++)</li></ul></li><li><p>Unix Makefiles 제너레이터 사용</p><ul><li>Visual Studio 대신 GCC 기반 빌드</li></ul></li><li><p>bash 스크립트 스타일로 변환</p><ul><li>인자 파싱</li><li>함수 정의</li><li>경로 처리</li></ul></li><li><p>빌드 시스템 변경</p><ul><li>make 사용</li><li>병렬 빌드 (-j8)</li></ul></li></ol><p>주의사항:</p><ol><li>스크립트를 실행하기 전에 실행 권한을 부여해야 합니다:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x opencv-build.sh
</span></span></code></pre></div><ol start=2><li><p>w64devkit의 경로가 다른 경우 W64DEVKIT_DIR 변수를 수정해야 합니다.</p></li><li><p>경로에 공백이 있는 경우 적절히 따옴표로 감싸져 있는지 확인하세요.</p></li><li><p>Git이 w64devkit 환경에서 사용 가능한지 확인하세요.</p></li></ol><p>이 스크립트는 w64devkit 환경에서 OpenCV를 빌드하는데 최적화되어 있습니다.</p><h1 id=bash-shell-to-use-windows-compiler-not-gcc>bash shell to use windows compiler, not gcc<a hidden class=anchor aria-hidden=true href=#bash-shell-to-use-windows-compiler-not-gcc>#</a></h1><p>Visual Studio에서 제공하는 <code>cl</code> 컴파일러 또는 <code>clang-cl</code>을 사용하여 OpenCV를 빌드하도록 스크립트를 수정하겠습니다. 주요 변경 사항은 다음과 같습니다:</p><ol><li><p><strong>컴파일러 및 도구 체인 설정</strong>:</p><ul><li><code>gcc</code>/<code>g++</code> 대신 <code>cl</code> 또는 <code>clang-cl</code>을 사용합니다.</li><li>CMake의 생성기(Generator)를 Visual Studio용으로 변경합니다.</li></ul></li><li><p><strong>빌드 시스템 변경</strong>:</p><ul><li><code>make</code> 대신 <code>MSBuild</code>를 사용하여 솔루션 파일(<code>*.sln</code>)을 빌드합니다.</li></ul></li><li><p><strong>환경 변수 설정</strong>:</p><ul><li>Visual Studio의 환경을 초기화하기 위해 <code>vcvarsall.bat</code>를 호출합니다.</li></ul></li><li><p><strong>플랫폼별 빌드 지원</strong>:</p><ul><li>x64와 ARM64 아키텍처를 명시적으로 지정합니다.</li></ul></li></ol><hr><h3 id=수정된-스크립트><strong>수정된 스크립트</strong><a hidden class=anchor aria-hidden=true href=#수정된-스크립트>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># Configuration</span>
</span></span><span style=display:flex><span>OPENCV_VERSION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;4.9.0&#34;</span>
</span></span><span style=display:flex><span>SCRIPT_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cd <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>dirname <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BASH_SOURCE[0]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&amp;&amp;</span> pwd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>SOURCE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SCRIPT_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/opencv_source&#34;</span>
</span></span><span style=display:flex><span>BUILD_BASE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SCRIPT_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/opencv_build&#34;</span>
</span></span><span style=display:flex><span>INSTALL_BASE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SCRIPT_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/opencv_install&#34;</span>
</span></span><span style=display:flex><span>VISUAL_STUDIO_PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Auxiliary/Build&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Default values</span>
</span></span><span style=display:flex><span>ACTION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;build&#34;</span>
</span></span><span style=display:flex><span>PLATFORM<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;all&#34;</span>
</span></span><span style=display:flex><span>USE_COVERITY<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Help function</span>
</span></span><span style=display:flex><span>show_help<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Usage: </span>$0<span style=color:#e6db74> [options]&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Options:&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;  -a, --action    Action to perform (build/clean) [default: build]&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;  -p, --platform  Platform to build (x64/arm64/all) [default: all]&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;  -c, --coverity  Enable Coverity build&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;  -h, --help      Show this help message&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Parse arguments</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#f92672>[[</span> $# -gt <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> $1 in
</span></span><span style=display:flex><span>        -a|--action<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            ACTION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            shift <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        -p|--platform<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            PLATFORM<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            shift <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        -c|--coverity<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            USE_COVERITY<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            shift
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        -h|--help<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            show_help
</span></span><span style=display:flex><span>            exit <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        *<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;Unknown option: </span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            show_help
</span></span><span style=display:flex><span>            exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>esac</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Validate arguments</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$ACTION<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span>~ ^<span style=color:#f92672>(</span>build|clean<span style=color:#f92672>)</span>$ <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Invalid action: </span>$ACTION<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span>~ ^<span style=color:#f92672>(</span>x64|arm64|all<span style=color:#f92672>)</span>$ <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Invalid platform: </span>$PLATFORM<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Setup environment</span>
</span></span><span style=display:flex><span>setup_visual_studio_env<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$arch<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;x64&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        cmd //c <span style=color:#e6db74>&#34;call \&#34;</span><span style=color:#e6db74>${</span>VISUAL_STUDIO_PATH<span style=color:#e6db74>}</span><span style=color:#e6db74>/vcvarsall.bat\&#34; x64 &amp;&amp; set &gt; env.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$arch<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;arm64&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        cmd //c <span style=color:#e6db74>&#34;call \&#34;</span><span style=color:#e6db74>${</span>VISUAL_STUDIO_PATH<span style=color:#e6db74>}</span><span style=color:#e6db74>/vcvarsall.bat\&#34; arm64 &amp;&amp; set &gt; env.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> read -r line; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        export <span style=color:#e6db74>&#34;</span>$line<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span> &lt; env.txt
</span></span><span style=display:flex><span>    rm env.txt
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Common CMake parameters</span>
</span></span><span style=display:flex><span>CMAKE_COMMON_PARAMS<span style=color:#f92672>=(</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DCMAKE_MINIMUM_REQUIRED_VERSION=3.10&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_SHARED_LIBS=ON&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_TESTS=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_PERF_TESTS=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_EXAMPLES=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DWITH_CUDA=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_world=ON&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_python2=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_opencv_python3=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DWITH_IPP=ON&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DENABLE_CXX11=ON&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DOPENCV_ENABLE_NONFREE=ON&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DBUILD_WITH_STATIC_CRT=OFF&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;-DCMAKE_BUILD_TYPE=Release&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Clean function</span>
</span></span><span style=display:flex><span>clean_build<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local build_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BUILD_BASE_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local install_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_BASE_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Cleaning </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74> build directories...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -d <span style=color:#e6db74>&#34;</span>$build_dir<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        rm -rf <span style=color:#e6db74>&#34;</span>$build_dir<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Removed build directory: </span>$build_dir<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -d <span style=color:#e6db74>&#34;</span>$install_dir<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        rm -rf <span style=color:#e6db74>&#34;</span>$install_dir<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Removed install directory: </span>$install_dir<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Download OpenCV source</span>
</span></span><span style=display:flex><span>get_opencv_source<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -d <span style=color:#e6db74>&#34;</span>$SOURCE_DIR<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Cloning OpenCV repository...&#34;</span>
</span></span><span style=display:flex><span>        git clone https://github.com/opencv/opencv.git <span style=color:#e6db74>&#34;</span>$SOURCE_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        pushd <span style=color:#e6db74>&#34;</span>$SOURCE_DIR<span style=color:#e6db74>&#34;</span> &gt; /dev/null
</span></span><span style=display:flex><span>        git checkout <span style=color:#e6db74>&#34;</span>$OPENCV_VERSION<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        popd &gt; /dev/null
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Build function</span>
</span></span><span style=display:flex><span>build_opencv<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local build_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BUILD_BASE_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local install_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_BASE_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Building OpenCV for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Set up Visual Studio environment</span>
</span></span><span style=display:flex><span>    setup_visual_studio_env <span style=color:#e6db74>&#34;</span>$arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create build directory</span>
</span></span><span style=display:flex><span>    mkdir -p <span style=color:#e6db74>&#34;</span>$build_dir<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    pushd <span style=color:#e6db74>&#34;</span>$build_dir<span style=color:#e6db74>&#34;</span> &gt; /dev/null
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Configure CMake</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Configuring CMake for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    local cmake_cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;cmake -G &#39;Visual Studio 17 2022&#39; \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        -A </span>$arch<span style=color:#e6db74> \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        -DCMAKE_INSTALL_PREFIX=&#39;</span><span style=color:#e6db74>${</span>install_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39; \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        </span><span style=color:#e6db74>${</span>CMAKE_COMMON_PARAMS[@]<span style=color:#e6db74>}</span><span style=color:#e6db74> \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#39;</span><span style=color:#e6db74>${</span>SOURCE_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $USE_COVERITY -eq <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Using Coverity Build...&#34;</span>
</span></span><span style=display:flex><span>        cov-build --dir <span style=color:#e6db74>&#34;./opencv_build/idir&#34;</span> eval <span style=color:#e6db74>&#34;</span>$cmake_cmd<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        eval <span style=color:#e6db74>&#34;</span>$cmake_cmd<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $? -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;CMake configuration failed for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        popd &gt; /dev/null
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Build and install</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Building and installing for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    local build_cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;MSBuild OpenCV.sln /p:Configuration=Release /p:Platform=</span>$arch<span style=color:#e6db74> /m&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $USE_COVERITY -eq <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        cov-build --dir <span style=color:#e6db74>&#34;./opencv_build/idir&#34;</span> eval <span style=color:#e6db74>&#34;</span>$build_cmd<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        eval <span style=color:#e6db74>&#34;</span>$build_cmd<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $? -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Build failed for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        popd &gt; /dev/null
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Install</span>
</span></span><span style=display:flex><span>    cmake --install . --config Release
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    popd &gt; /dev/null
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Build completed for </span><span style=color:#e6db74>${</span>arch<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Main execution</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;OpenCV Build Script&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Script Directory: </span>$SCRIPT_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Action: </span>$ACTION<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Platform: </span>$PLATFORM<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Coverity: </span>$USE_COVERITY<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Handle clean action</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$ACTION<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;clean&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;all&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;x64&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        clean_build <span style=color:#e6db74>&#34;x64&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;all&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;arm64&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        clean_build <span style=color:#e6db74>&#34;arm64&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Handle build action</span>
</span></span><span style=display:flex><span>get_opencv_source
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;all&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;x64&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    build_opencv <span style=color:#e6db74>&#34;x64&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;all&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PLATFORM<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;arm64&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    build_opencv <span style=color:#e6db74>&#34;arm64&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Script completed successfully&#34;</span>
</span></span></code></pre></div><hr><h3 id=주요-변경-사항-설명><strong>주요 변경 사항 설명</strong><a hidden class=anchor aria-hidden=true href=#주요-변경-사항-설명>#</a></h3><ol><li><p><strong>Visual Studio 환경 설정</strong>:</p><ul><li><code>vcvarsall.bat</code>를 호출하여 x64 또는 ARM64 환경을 초기화합니다.</li><li>환경 변수를 읽어 Bash에서 사용할 수 있도록 처리합니다.</li></ul></li><li><p><strong>CMake 생성기 변경</strong>:</p><ul><li><code>-G 'Visual Studio 17 2022'</code>를 사용하여 Visual Studio 프로젝트를 생성합니다.</li><li><code>-A $arch</code>로 플랫폼(x64 또는 ARM64)을 명시합니다.</li></ul></li><li><p><strong>빌드 시스템 변경</strong>:</p><ul><li><code>MSBuild</code>를 사용하여 <code>.sln</code> 파일을 빌드합니다.</li><li><code>/p:Configuration=Release</code>와 <code>/p:Platform=$arch</code>로 빌드 옵션을 설정합니다.</li></ul></li><li><p><strong>Coverity 지원</strong>:</p><ul><li>Coverity를 사용하는 경우에도 동일한 방식으로 적용됩니다.</li></ul></li></ol><hr><h3 id=사용-방법><strong>사용 방법</strong><a hidden class=anchor aria-hidden=true href=#사용-방법>#</a></h3><ol><li><p>스크립트를 저장하고 실행 권한을 부여합니다:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x build_opencv.sh
</span></span></code></pre></div></li><li><p>스크립트를 실행합니다:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./build_opencv.sh -a build -p all
</span></span></code></pre></div></li><li><p>필요한 경우 <code>-c</code> 옵션으로 Coverity 빌드를 활성화합니다:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./build_opencv.sh -a build -p x64 -c
</span></span></code></pre></div></li></ol><hr><p>이 스크립트를 통해 Visual Studio의 <code>cl</code> 또는 <code>clang-cl</code>을 사용하여 OpenCV를 성공적으로 빌드할 수 있습니다.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://jongyongpark.github.io/tags/opencv/>OpenCV</a></li><li><a href=https://jongyongpark.github.io/tags/windows/>Windows</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://jongyongpark.github.io/>RyanLabs</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>